# @name variables
@base_url = https://localhost:7551
@keycloak_url = http://localhost:8080
@realm = botsignals
@client_id = bot-signal-api
@client_secret = LDehI9cDx8TsM93hgSsBayyhx1cXCUqv
@jwt_token = ""
### ===== AUTENTICAÃ‡ÃƒO BOT SINAIS =====

### 1. ğŸ¥ Status do Keycloak (DiagnÃ³stico)
GET {{base_url}}/api/auth/keycloak-status
Accept: application/json

### 2. â„¹ï¸ InformaÃ§Ãµes de AutenticaÃ§Ã£o (PÃºblico)
GET {{base_url}}/api/auth/info
Accept: application/json

### 3. ğŸ” AutenticaÃ§Ã£o Direta - Obter JWT Token
# @name auth_request
POST {{base_url}}/api/auth/authenticate
Content-Type: application/json

{
  "username": "dev_keycloak_user",
  "password": "dev_keycloak_password"
}

###
// Captura automÃ¡tica do token JWT da resposta
# Execute a requisiÃ§Ã£o 'auth_request' antes desta linha para garantir que a resposta exista
@jwt_token = {{auth_request.response.body.$.accessToken}}

### 3B. ğŸ” Teste Direto: Obter Token via Keycloak (ROPC)
# @name keycloak_request
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id={{client_id}}&client_secret={{client_secret}}&username=dev_keycloak_user&password=dev_keycloak_password

###
// Captura automÃ¡tica do token do Keycloak
@jwt_token_alt = {{keycloak_request.response.body.$.access_token}}

### ===== TESTES DIRETOS NO KEYCLOAK =====

### 4. ğŸ”‘ Teste Direto: Obter Token via Keycloak (ROPC)
# @name keycloak_request
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id={{client_id}}&client_secret={{client_secret}}&username=dev_keycloak_user&password=dev_keycloak_password

###
// Captura automÃ¡tica do token do Keycloak
@jwt_token_alt = {{keycloak_request.response.body.$.access_token}}

### 6. ğŸ“‹ Teste de Realm Info (PÃºblico)
GET {{keycloak_url}}/realms/{{realm}}
Accept: application/json

### 7. ğŸ”§ Well-known Configuration
GET {{keycloak_url}}/realms/{{realm}}/.well-known/openid_configuration
Accept: application/json

### ===== VALIDAÃ‡ÃƒO DE TOKEN KEYCLOAK =====

### 8A. ğŸ” Validar Token via Keycloak (Token Introspection)
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token/introspect
Content-Type: application/x-www-form-urlencoded
Authorization: Basic {{client_id}}:{{client_secret}}

token={{jwt_token}}&token_type_hint=access_token

### 8B. ğŸ” Validar Token via Keycloak (Alternative com Client Auth)
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token/introspect
Content-Type: application/x-www-form-urlencoded

token={{jwt_token}}&token_type_hint=access_token&client_id={{client_id}}&client_secret={{client_secret}}

### 8C. ğŸ” Obter InformaÃ§Ãµes do UsuÃ¡rio via Keycloak UserInfo
GET {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/userinfo
Accept: application/json
Authorization: Bearer {{jwt_token}}

### ===== ENDPOINTS PROTEGIDOS (Requer JWT Token) =====

### 9. âœ… Validar Token JWT (Nossa API)
GET {{base_url}}/api/auth/validate
Accept: application/json
Authorization: Bearer {{jwt_token}}

### 10. ğŸ‘¤ Obter InformaÃ§Ãµes do UsuÃ¡rio (Nossa API)
GET {{base_url}}/api/auth/me
Accept: application/json
Authorization: Bearer {{jwt_token}}

### 11. ğŸšª Logout Completo
POST {{base_url}}/api/auth/logout
Content-Type: application/json
Authorization: Bearer {{jwt_token}}

{
  "postLogoutRedirectUri": "http://localhost:3000/"
}

### 12. ğŸšª Logout Simples
POST {{base_url}}/api/auth/logout
Authorization: Bearer {{jwt_token}}

### 13. ğŸšª Logout via Keycloak (RevogaÃ§Ã£o de Token)
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/logout
Content-Type: application/x-www-form-urlencoded

client_id={{client_id}}&client_secret={{client_secret}}&refresh_token={{jwt_token_alt}}

### ===== TESTES DE CONECTIVIDADE =====

### 14. ğŸŒ Teste de Conectividade - API Local
GET {{base_url}}/health
Accept: application/json

### 15. ğŸŒ Teste de Conectividade - Keycloak
GET {{keycloak_url}}/health
Accept: application/json

### ===== UTILITÃRIOS DE DEBUG =====

### 16. ğŸ” Debug: Verificar Token Atual (Nossa API)
GET {{base_url}}/api/auth/validate
Accept: application/json
Authorization: Bearer {{jwt_token}}

### 17. ğŸ•’ Debug: Decodificar JWT (Verificar se token estÃ¡ vÃ¡lido)
GET {{base_url}}/api/auth/me
Accept: application/json
Authorization: Bearer {{jwt_token}}

### 18. ğŸ” Debug: IntrospecÃ§Ã£o de Token (Keycloak)
POST {{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token/introspect
Content-Type: application/x-www-form-urlencoded

token={{jwt_token}}&token_type_hint=access_token&client_id={{client_id}}&client_secret={{client_secret}}

### ===== FLUXO DE TRABALHO RECOMENDADO =====

# ğŸ¯ FLUXO PRINCIPAL DE USO:
# 
# 1ï¸âƒ£ Primeiro execute: "Status do Keycloak" para verificar conectividade
# 2ï¸âƒ£ Execute: "AutenticaÃ§Ã£o Direta" para obter JWT (token serÃ¡ salvo automaticamente)
# 3ï¸âƒ£ Teste validaÃ§Ã£o: "Validar Token via Keycloak (Token Introspection)" 
# 4ï¸âƒ£ Teste endpoints protegidos: "Validar Token" e "Obter InformaÃ§Ãµes do UsuÃ¡rio"
# 5ï¸âƒ£ Para finalizar: "Logout"
#
# ğŸ”„ ALTERNATIVO - Teste direto no Keycloak:
# Execute "Teste Direto: Obter Token via Keycloak" em vez do passo 2
#
# ğŸ” VALIDAÃ‡ÃƒO DE TOKEN:
# - Use "Token Introspection" (8A/8B) para validar se o token estÃ¡ ativo
# - Use "UserInfo" (8C) para obter informaÃ§Ãµes do usuÃ¡rio a partir do token
# - Compare com nossa API (9/10) para verificar se a validaÃ§Ã£o estÃ¡ funcionando
